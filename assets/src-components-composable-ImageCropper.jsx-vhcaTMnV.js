import{r as o,j as s}from"./pnpm-react@18.3.1--FUz9cRTN.js";import{u as U}from"./src-store-useSettingsStore.js--zqtBzO6.js";import{u as H}from"./pnpm-zustand@4.5.4_@types_react@18.3.3_react@18.3.1--EhdkWrrw.js";import{X as T,y as W,H as M,I as A}from"./pnpm-react-image-crop@11.0.6_react@18.3.1--DSzYCrTu.js";import{t as L}from"./src-components-ui-use-toast.js-w7cDmHIs.js";import{u as X}from"./src-hooks-useUpdateProfilePhoto.jsx-DsSEtzQb.js";import{L as C}from"./src-components-composable-Loading.jsx-DE_-Iq74.js";import{u as D}from"./pnpm-react-i18next@15.0.1_i18next@23.12.2_react-dom@18.3.1_react@18.3.1__react@18.3.1--C-fP4VmU.js";import{a as O}from"./pnpm-react-router@6.26.0_react@18.3.1--BYg1aRBq.js";import{m as Y}from"./pnpm-framer-motion@11.3.22_react-dom@18.3.1_react@18.3.1__react@18.3.1--COr7I5SZ.js";const P=1,b=150,z=(a,l,i,g)=>{const e=l.getContext("2d");e||L({description:g("no_2d_context"),duration:3e3,variant:"destructive"});const n=window.devicePixelRatio,h=a.naturalWidth/a.width,p=a.naturalHeight/a.height;l.width=Math.floor(i.width*h*n),l.height=Math.floor(i.height*p*n),e.scale(n,n),e.imageSmoothingQuality="high",e.save();const f=i.x*h,v=i.y*p;e.translate(-f,-v),e.drawImage(a,0,0,a.naturalWidth,a.naturalHeight,0,0,a.naturalWidth,a.naturalHeight),e.restore()},te=()=>{const[a,l,i,g]=U(H(t=>[t.imageFile,t.setImageFile,t.haveSelectImageFile,t.setHaveSelectImageFile])),{t:e}=D(),n=O(),h=X(),[p,f]=o.useState(!1),[v,E]=o.useState(!1),x=o.useRef(null),I=o.useRef(null),[w,j]=o.useState(),[N,y]=o.useState(""),[_,F]=o.useState(!1),R=t=>{const{width:r,height:u}=t.currentTarget,c=b/r*100,d=M({unit:"%",width:c},P,r,u),m=A(d,r,u);j(m)},k=()=>{l(""),g(!1),n("/settings")};return o.useEffect(()=>{i||n("/settings")},[]),o.useEffect(()=>{const t=new FileReader,r=(c,d)=>{const{naturalWidth:m,naturalHeight:S}=c.currentTarget;if(m<b||S<b)return L({description:e("image_too_small"),variant:"destructive",duration:3e3}),k(),y("");y(d)},u=()=>{var m;const c=((m=t.result)==null?void 0:m.toString())||"",d=new Image;d.src=c,d.addEventListener("load",S=>{r(S,c)})};return t.addEventListener("load",u),i&&t.readAsDataURL(a),()=>{t.removeEventListener("load",u),l(""),g(!1)}},[]),s.jsxs(Y.div,{className:"min-w-screen no-scrollbar z-30 flex min-h-screen flex-col items-center justify-start bg-white dark:bg-black",initial:{opacity:0,transition:{duration:.2}},animate:{opacity:1,transition:{duration:.2}},exit:{opacity:0,transition:{duration:.2}},children:[s.jsx("div",{className:"m-4 mb-[70px] flex max-h-max max-w-[400px] items-center justify-center",children:s.jsx(T,{onChange:(t,r)=>{j(r)},crop:w,circularCrop:!0,keepSelection:!0,aspect:P,minWidth:b,children:s.jsx("img",{ref:x,src:N,alt:"CroppedImage",className:"max-h-[450px] min-h-[150px] min-w-[150px] border border-slate-400 object-contain duration-100 dark:border dark:border-slate-600",onLoad:R})})}),s.jsxs("div",{className:"fixed bottom-0 left-0 right-0 flex h-[60px] items-center justify-center bg-white text-slate-900 dark:bg-black dark:text-slate-100",children:[s.jsx("button",{className:"mx-4 my-2 inline-block rounded-md px-4 py-2 active:bg-slate-200 dark:active:bg-slate-800",onClick:k,children:e("cancel")}),s.jsx("button",{className:"mx-4 my-2 inline-block rounded-md px-4 py-2 active:bg-slate-200 dark:active:bg-slate-800",onClick:async()=>{_||(z(x.current,I.current,W(w,x.current.width,x.current.height),e),await h(I.current),f(!0),setTimeout(()=>{f(!1),E(!0)},4e3)),F(!0)},children:e("done")})]}),w&&s.jsx("canvas",{ref:I,style:{display:"none",width:150,height:150,objectFit:"contain"},className:"mb-[140px]"}),p&&s.jsx(C,{message:e("loading_compress_image")}),v&&s.jsx(C,{message:e("loading_upload_image")})]})};export{te as I};
