import{u as r}from"./pnpm-zustand@4.5.4_@types_react@18.3.3_react@18.3.1--EhdkWrrw.js";import{u as T}from"./src-store-appStore.js-CeccZLF4.js";import{u as M}from"./src-store-useChatsStore.js-D4_VXnQ2.js";import{u as x}from"./src-store-useSettingsStore.js--zqtBzO6.js";import{u as F}from"./src-hooks-useOnlineStatus.jsx-6CQSTZAH.js";import{u as q}from"./src-hooks-useUtils.jsx-BAc6yY_X.js";import{sleep as g}from"./src-lib-generateTime.js-DFXwsD9v.js";import{getGroqReply as G}from"./src-controller-groq.js-BFN03C6J.js";import{addNewChatsToFirestore as b}from"./src-controller-CRUDFirestore.js-DWHzvynk.js";import{u as A}from"./pnpm-react-i18next@15.0.1_i18next@23.12.2_react-dom@18.3.1_react@18.3.1__react@18.3.1--C-fP4VmU.js";const z=()=>{const[n,a,m,o]=M(r(e=>[e.setChats,e.getChats,e.setChatsMemory,e.getChatsMemory])),[c]=x(r(e=>[e.model])),[p,u,h,d,f,l]=T(r(e=>[e.senTyping,e.setSenTyping,e.userId,e.loading,e.setMessageFromUser,e.setGroqFetchProses])),S=F(),{t:w}=A(),y=q();return async(e,i="text")=>{if(i==="text"&&e.trim().length===0||p||d)return;const t={type:i,position:"right",time:new Date().getTime(),message:e};f(""),n([...a(),t]),i==="audio"&&(t.message=e.text,t.downloadUrl=e.downloadUrl,t.audioFileName=e.audioFileName);const s={type:"text",position:"left",time:null,message:null};if(S){await g(1e3),u(!0),l("start"),m([...o(),{time:t.time,role:"user",content:t.message}]);const C=await G(t.message,c,y,o());s.time=new Date().getTime(),s.message=C,m([...o(),{time:s.time,role:"assistant",content:s.message}]),b(h,t,s)}else s.time=new Date().getTime(),s.message=w("senAi_cant_receive_message");u(!1),await g(500),n([...a(),s]),l("end")}};export{z as u};
