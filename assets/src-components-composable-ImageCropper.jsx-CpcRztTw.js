import{r as i,j as s}from"./pnpm-react@18.3.1--FUz9cRTN.js";import{u as F}from"./src-store-useSettingsStore.js-CdjOmluh.js";import{u as P}from"./pnpm-zustand@4.5.4_@types_react@18.3.3_react@18.3.1--EhdkWrrw.js";import{X as _,y as L,H as U,I as A}from"./pnpm-react-image-crop@11.0.6_react@18.3.1--DSzYCrTu.js";import{t as S}from"./src-components-ui-use-toast.js-w7cDmHIs.js";import{D as W}from"./src-components-svg-DynamicSvg.jsx-BgCrTit6.js";import{u as D}from"./src-hooks-useUpdateProfilePhoto.jsx-BZeuVCGJ.js";import{u as M}from"./pnpm-react-i18next@15.0.1_i18next@23.12.2_react-dom@18.3.1_react@18.3.1__react@18.3.1--C-fP4VmU.js";import{a as O}from"./pnpm-react-router@6.26.0_react@18.3.1--BYg1aRBq.js";import{m as $}from"./pnpm-framer-motion@11.3.22_react-dom@18.3.1_react@18.3.1__react@18.3.1--COr7I5SZ.js";const E=1,v=150;let x=0,o=90;const X=(a,m,c,f)=>{const t=m.getContext("2d");t||S({description:f("no_2d_context"),duration:3e3,variant:"destructive"});const l=window.devicePixelRatio,y=a.naturalWidth/a.width,b=a.naturalHeight/a.height;m.width=Math.floor(c.width*y*l),m.height=Math.floor(c.height*b*l),t.scale(l,l),t.imageSmoothingQuality="high",t.save();const e=c.x*y,n=c.y*b;t.translate(-e,-n),t.drawImage(a,0,0,a.naturalWidth,a.naturalHeight,0,0,a.naturalWidth,a.naturalHeight),t.restore()},ee=()=>{const[a,m,c,f]=F(P(r=>[r.imageFile,r.setImageFile,r.haveSelectImageFile,r.setHaveSelectImageFile])),{t}=M(),l=O(),y=D(),b=i.useRef(null),e=i.useRef(null),n=i.useRef(null),w=i.useRef(null),[k,C]=i.useState(),[H,R]=i.useState(""),N=r=>{const{width:d,height:p}=r.currentTarget,u=v/d*100,h=U({unit:"%",width:u},E,d,p),g=A(h,d,p);C(g)},j=()=>{m(""),f(!1),l("/settings")};i.useEffect(()=>{c||l("/settings")},[]),i.useEffect(()=>{const r=new FileReader,d=(u,h)=>{const{naturalWidth:g,naturalHeight:I}=u.currentTarget;if(g<v||I<v)return S({description:t("image_too_small"),variant:"destructive",duration:3e3}),j(),R("");R(h)},p=()=>{var g;const u=((g=r.result)==null?void 0:g.toString())||"",h=new Image;h.src=u,h.addEventListener("load",I=>{d(I,u)})};return r.addEventListener("load",p),c&&r.readAsDataURL(a),()=>{r.removeEventListener("load",p),m(""),f(!1)}},[]);const T=()=>{switch(x){case 0:n.current.style.rotate=`-${o}deg`,e.current.style.height="300px",e.current.style.minHeight="300px",e.current.style.maxHeight="300px",o+=90,x=1;break;case 1:n.current.style.rotate=`-${o}deg`,e.current.style.height="450px",e.current.style.minHeight="450px",e.current.style.maxHeight="450px",o+=90,x=2;break;case 2:n.current.style.rotate=`-${o}deg`,e.current.style.height="300px",e.current.style.minHeight="300px",e.current.style.maxHeight="300px",o+=90,x=3;break;case 3:n.current.style.rotate=`-${o}deg`,e.current.style.height="450px",e.current.style.minHeight="450px",e.current.style.maxHeight="450px",o+=90,x=0;break}};return s.jsxs($.div,{className:"min-w-screen no-scrollbar z-30 flex min-h-screen flex-col items-center justify-center bg-white dark:bg-black",initial:{opacity:0,transition:{duration:.2}},animate:{opacity:1,transition:{duration:.2}},exit:{opacity:0,transition:{duration:.2}},children:[s.jsx("div",{className:"m-4 flex max-h-[550px] max-w-[400px] items-center justify-center overflow-hidden",ref:e,children:s.jsx(_,{ref:b,onChange:(r,d)=>{C(d)},crop:k,circularCrop:!0,keepSelection:!0,aspect:E,minWidth:v,children:s.jsx("img",{ref:n,src:H,alt:"CroppedImage",className:"max-h-[450px] min-h-[150px] min-w-[150px] border border-slate-400 object-contain duration-100 dark:border dark:border-slate-600",onLoad:N})})}),s.jsxs("div",{className:"fixed bottom-0 left-0 right-0 flex h-[60px] items-center justify-center bg-white text-slate-900 dark:bg-black dark:text-slate-100",children:[s.jsx("button",{className:"mx-4 my-2 inline-block rounded-md px-4 py-2 active:bg-slate-200 dark:active:bg-slate-800",onClick:j,children:t("cancel")}),s.jsx("button",{className:"mx-4 my-2 inline-block rounded-md px-4 py-2 active:bg-slate-200 dark:active:bg-slate-800",onClick:T,children:s.jsx(W,{name:"ArrowCounterClockwise",className:"h-8 w-8"})}),s.jsx("button",{className:"mx-4 my-2 inline-block rounded-md px-4 py-2 active:bg-slate-200 dark:active:bg-slate-800",onClick:()=>{X(n.current,w.current,L(k,n.current.width,n.current.height),t),y(w.current)},children:t("done")})]}),k&&s.jsx("canvas",{ref:w,style:{display:"none",width:150,height:150,objectFit:"contain"},className:"mb-[140px]"})]})};export{ee as I};
