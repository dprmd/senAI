import{r as i,j as a}from"./pnpm-react@18.3.1--FUz9cRTN.js";import{u as U}from"./src-store-useSettingsStore.js-DBU6w3vm.js";import{u as H}from"./pnpm-zustand@4.5.4_@types_react@18.3.3_react@18.3.1--EhdkWrrw.js";import{X as T,y as W,H as M,I as A}from"./pnpm-react-image-crop@11.0.6_react@18.3.1--DSzYCrTu.js";import{t as P}from"./src-components-ui-use-toast.js-w7cDmHIs.js";import{u as X}from"./src-hooks-useUpdateProfilePhoto.jsx-CBUwuGo9.js";import{L as C}from"./src-components-composable-Loading.jsx-CK2u8AZz.js";import{u as D}from"./pnpm-react-i18next@15.0.1_i18next@23.12.2_react-dom@18.3.1_react@18.3.1__react@18.3.1--C-fP4VmU.js";import{a as O}from"./pnpm-react-router@6.26.0_react@18.3.1--BYg1aRBq.js";import{m as Y}from"./pnpm-framer-motion@11.3.22_react-dom@18.3.1_react@18.3.1__react@18.3.1--COr7I5SZ.js";const R=1,x=150,z=(t,l,r,p)=>{const o=l.getContext("2d");o||P({description:p("no_2d_context"),duration:3e3,variant:"destructive"});const c=window.devicePixelRatio,n=t.naturalWidth/t.width,u=t.naturalHeight/t.height;l.width=Math.floor(r.width*n*c),l.height=Math.floor(r.height*u*c),o.scale(c,c),o.imageSmoothingQuality="high",o.save();const b=r.x*n,v=r.y*u;o.translate(-b,-v),o.drawImage(t,0,0,t.naturalWidth,t.naturalHeight,0,0,t.naturalWidth,t.naturalHeight),o.restore()},te=()=>{const[t,l,r,p,o,c]=U(H(e=>[e.imageFile,e.setImageFile,e.haveSelectImageFile,e.setHaveSelectImageFile,e.loadingCompressImage,e.loadingUploadImage])),{t:n}=D(),u=O(),b=X(),v=i.useRef(null),E=i.useRef(null),f=i.useRef(null),I=i.useRef(null),[w,y]=i.useState(),[N,S]=i.useState(""),[_,F]=i.useState(!1),L=e=>{const{width:s,height:h}=e.currentTarget,d=x/s*100,m=M({unit:"%",width:d},R,s,h),g=A(m,s,h);y(g)},k=()=>{l(""),p(!1),u("/settings")};return i.useEffect(()=>{r||u("/settings")},[]),i.useEffect(()=>{const e=new FileReader,s=(d,m)=>{const{naturalWidth:g,naturalHeight:j}=d.currentTarget;if(g<x||j<x)return P({description:n("image_too_small"),variant:"destructive",duration:3e3}),k(),S("");S(m)},h=()=>{var g;const d=((g=e.result)==null?void 0:g.toString())||"",m=new Image;m.src=d,m.addEventListener("load",j=>{s(j,d)})};return e.addEventListener("load",h),r&&e.readAsDataURL(t),()=>{e.removeEventListener("load",h),l(""),p(!1)}},[]),a.jsxs(Y.div,{className:"min-w-screen no-scrollbar z-30 flex min-h-screen flex-col items-center justify-start bg-white dark:bg-black",initial:{opacity:0,transition:{duration:.2}},animate:{opacity:1,transition:{duration:.2}},exit:{opacity:0,transition:{duration:.2}},children:[a.jsx("div",{className:"m-4 mb-[70px] flex max-h-max max-w-[400px] items-center justify-center",ref:E,children:a.jsx(T,{ref:v,onChange:(e,s)=>{y(s)},crop:w,circularCrop:!0,keepSelection:!0,aspect:R,minWidth:x,children:a.jsx("img",{ref:f,src:N,alt:"CroppedImage",className:"max-h-[450px] min-h-[150px] min-w-[150px] border border-slate-400 object-contain duration-100 dark:border dark:border-slate-600",onLoad:L})})}),a.jsxs("div",{className:"fixed bottom-0 left-0 right-0 flex h-[60px] items-center justify-center bg-white text-slate-900 dark:bg-black dark:text-slate-100",children:[a.jsx("button",{className:"mx-4 my-2 inline-block rounded-md px-4 py-2 active:bg-slate-200 dark:active:bg-slate-800",onClick:k,children:n("cancel")}),a.jsx("button",{className:"mx-4 my-2 inline-block rounded-md px-4 py-2 active:bg-slate-200 dark:active:bg-slate-800",onClick:async()=>{_||(z(f.current,I.current,W(w,f.current.width,f.current.height),n),await b(I.current)),F(!0)},children:n("done")})]}),w&&a.jsx("canvas",{ref:I,style:{display:"none",width:150,height:150,objectFit:"contain"},className:"mb-[140px]"}),o&&a.jsx(C,{message:n("loading_compress_image")}),c&&a.jsx(C,{message:n("loading_upload_image")})]})};export{te as I};
