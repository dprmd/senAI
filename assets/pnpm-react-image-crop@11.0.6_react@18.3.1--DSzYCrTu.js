import{r as E,R as p}from"./pnpm-react@18.3.1--FUz9cRTN.js";const M={x:0,y:0,width:0,height:0,unit:"px"},b=(s,e,t)=>Math.min(Math.max(s,e),t),H=(...s)=>s.filter(e=>e&&typeof e=="string").join(" "),Y=(s,e)=>s===e||s.width===e.width&&s.height===e.height&&s.x===e.x&&s.y===e.y&&s.unit===e.unit;function P(s,e,t,o){const i=x(s,t,o);return s.width&&(i.height=i.width/e),s.height&&(i.width=i.height*e),i.y+i.height>o&&(i.height=o-i.y,i.width=i.height*e),i.x+i.width>t&&(i.width=t-i.x,i.height=i.width/e),s.unit==="%"?v(i,t,o):i}function S(s,e,t){const o=x(s,e,t);return o.x=(e-o.width)/2,o.y=(t-o.height)/2,s.unit==="%"?v(o,e,t):o}function v(s,e,t){return s.unit==="%"?{...M,...s,unit:"%"}:{unit:"%",x:s.x?s.x/e*100:0,y:s.y?s.y/t*100:0,width:s.width?s.width/e*100:0,height:s.height?s.height/t*100:0}}function x(s,e,t){return s.unit?s.unit==="px"?{...M,...s,unit:"px"}:{unit:"px",x:s.x?s.x*e/100:0,y:s.y?s.y*t/100:0,width:s.width?s.width*e/100:0,height:s.height?s.height*t/100:0}:{...M,...s,unit:"px"}}function k(s,e,t,o,i,n=0,a=0,l=o,h=i){const r={...s};let c=Math.min(n,o),w=Math.min(a,i),g=Math.min(l,o),d=Math.min(h,i);e&&(e>1?(c=a?a*e:c,w=c/e,g=l*e):(w=n?n/e:w,c=w*e,d=h/e)),r.y<0&&(r.height=Math.max(r.height+r.y,w),r.y=0),r.x<0&&(r.width=Math.max(r.width+r.x,c),r.x=0);const m=o-(r.x+r.width);m<0&&(r.x=Math.min(r.x,o-c),r.width+=m);const y=i-(r.y+r.height);if(y<0&&(r.y=Math.min(r.y,i-w),r.height+=y),r.width<c&&((t==="sw"||t=="nw")&&(r.x-=c-r.width),r.width=c),r.height<w&&((t==="nw"||t=="ne")&&(r.y-=w-r.height),r.height=w),r.width>g&&((t==="sw"||t=="nw")&&(r.x-=g-r.width),r.width=g),r.height>d&&((t==="nw"||t=="ne")&&(r.y-=d-r.height),r.height=d),e){const f=r.width/r.height;if(f<e){const C=Math.max(r.width/e,w);(t==="nw"||t=="ne")&&(r.y-=C-r.height),r.height=C}else if(f>e){const C=Math.max(r.height*e,c);(t==="sw"||t=="nw")&&(r.x-=C-r.width),r.width=C}}return r}function X(s,e,t,o){const i={...s};return e==="ArrowLeft"?o==="nw"?(i.x-=t,i.y-=t,i.width+=t,i.height+=t):o==="w"?(i.x-=t,i.width+=t):o==="sw"?(i.x-=t,i.width+=t,i.height+=t):o==="ne"?(i.y+=t,i.width-=t,i.height-=t):o==="e"?i.width-=t:o==="se"&&(i.width-=t,i.height-=t):e==="ArrowRight"&&(o==="nw"?(i.x+=t,i.y+=t,i.width-=t,i.height-=t):o==="w"?(i.x+=t,i.width-=t):o==="sw"?(i.x+=t,i.width-=t,i.height-=t):o==="ne"?(i.y-=t,i.width+=t,i.height+=t):o==="e"?i.width+=t:o==="se"&&(i.width+=t,i.height+=t)),e==="ArrowUp"?o==="nw"?(i.x-=t,i.y-=t,i.width+=t,i.height+=t):o==="n"?(i.y-=t,i.height+=t):o==="ne"?(i.y-=t,i.width+=t,i.height+=t):o==="sw"?(i.x+=t,i.width-=t,i.height-=t):o==="s"?i.height-=t:o==="se"&&(i.width-=t,i.height-=t):e==="ArrowDown"&&(o==="nw"?(i.x+=t,i.y+=t,i.width-=t,i.height-=t):o==="n"?(i.y+=t,i.height-=t):o==="ne"?(i.y+=t,i.width-=t,i.height-=t):o==="sw"?(i.x-=t,i.width+=t,i.height+=t):o==="s"?i.height+=t:o==="se"&&(i.width+=t,i.height+=t)),i}const R={capture:!0,passive:!1};let _=0;const D=class u extends E.PureComponent{constructor(){super(...arguments),this.docMoveBound=!1,this.mouseDownOnCrop=!1,this.dragStarted=!1,this.evData={startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0},this.componentRef=E.createRef(),this.mediaRef=E.createRef(),this.initChangeCalled=!1,this.instanceId=`rc-${_++}`,this.state={cropIsActive:!1,newCropIsBeingDrawn:!1},this.onCropPointerDown=e=>{const{crop:t,disabled:o}=this.props,i=this.getBox();if(!t)return;const n=x(t,i.width,i.height);if(o)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const a=e.target.dataset.ord,l=!!a;let h=e.clientX,r=e.clientY,c=n.x,w=n.y;if(a){const g=e.clientX-i.x,d=e.clientY-i.y;let m=0,y=0;a==="ne"||a=="e"?(m=g-(n.x+n.width),y=d-n.y,c=n.x,w=n.y+n.height):a==="se"||a==="s"?(m=g-(n.x+n.width),y=d-(n.y+n.height),c=n.x,w=n.y):a==="sw"||a=="w"?(m=g-n.x,y=d-(n.y+n.height),c=n.x+n.width,w=n.y):(a==="nw"||a=="n")&&(m=g-n.x,y=d-n.y,c=n.x+n.width,w=n.y+n.height),h=c+i.x+m,r=w+i.y+y}this.evData={startClientX:h,startClientY:r,startCropX:c,startCropY:w,clientX:e.clientX,clientY:e.clientY,isResize:l,ord:a},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})},this.onComponentPointerDown=e=>{const{crop:t,disabled:o,locked:i,keepSelection:n,onChange:a}=this.props,l=this.getBox();if(o||i||n&&t)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const h=e.clientX-l.x,r=e.clientY-l.y,c={unit:"px",x:h,y:r,width:0,height:0};this.evData={startClientX:e.clientX,startClientY:e.clientY,startCropX:h,startCropY:r,clientX:e.clientX,clientY:e.clientY,isResize:!0},this.mouseDownOnCrop=!0,a(x(c,l.width,l.height),v(c,l.width,l.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})},this.onDocPointerMove=e=>{const{crop:t,disabled:o,onChange:i,onDragStart:n}=this.props,a=this.getBox();if(o||!t||!this.mouseDownOnCrop)return;e.cancelable&&e.preventDefault(),this.dragStarted||(this.dragStarted=!0,n&&n(e));const{evData:l}=this;l.clientX=e.clientX,l.clientY=e.clientY;let h;l.isResize?h=this.resizeCrop():h=this.dragCrop(),Y(t,h)||i(x(h,a.width,a.height),v(h,a.width,a.height))},this.onComponentKeyDown=e=>{const{crop:t,disabled:o,onChange:i,onComplete:n}=this.props;if(o)return;const a=e.key;let l=!1;if(!t)return;const h=this.getBox(),r=this.makePixelCrop(h),c=(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?u.nudgeStepLarge:e.shiftKey?u.nudgeStepMedium:u.nudgeStep;if(a==="ArrowLeft"?(r.x-=c,l=!0):a==="ArrowRight"?(r.x+=c,l=!0):a==="ArrowUp"?(r.y-=c,l=!0):a==="ArrowDown"&&(r.y+=c,l=!0),l){e.cancelable&&e.preventDefault(),r.x=b(r.x,0,h.width-r.width),r.y=b(r.y,0,h.height-r.height);const w=x(r,h.width,h.height),g=v(r,h.width,h.height);i(w,g),n&&n(w,g)}},this.onHandlerKeyDown=(e,t)=>{const{aspect:o=0,crop:i,disabled:n,minWidth:a=0,minHeight:l=0,maxWidth:h,maxHeight:r,onChange:c,onComplete:w}=this.props,g=this.getBox();if(n||!i)return;if(e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="ArrowLeft"||e.key==="ArrowRight")e.stopPropagation(),e.preventDefault();else return;const d=(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?u.nudgeStepLarge:e.shiftKey?u.nudgeStepMedium:u.nudgeStep,m=x(i,g.width,g.height),y=X(m,e.key,d,t),f=k(y,o,t,g.width,g.height,a,l,h,r);if(!Y(i,f)){const C=v(f,g.width,g.height);c(f,C),w&&w(f,C)}},this.onDocPointerDone=e=>{const{crop:t,disabled:o,onComplete:i,onDragEnd:n}=this.props,a=this.getBox();this.unbindDocMove(),!(o||!t)&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,n&&n(e),i&&i(x(t,a.width,a.height),v(t,a.width,a.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))},this.onDragFocus=()=>{var e;(e=this.componentRef.current)==null||e.scrollTo(0,0)}}get document(){return document}getBox(){const e=this.mediaRef.current;if(!e)return{x:0,y:0,width:0,height:0};const{x:t,y:o,width:i,height:n}=e.getBoundingClientRect();return{x:t,y:o,width:i,height:n}}componentDidUpdate(e){const{crop:t,onComplete:o}=this.props;if(o&&!e.crop&&t){const{width:i,height:n}=this.getBox();i&&n&&o(x(t,i,n),v(t,i,n))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,R),this.document.addEventListener("pointerup",this.onDocPointerDone,R),this.document.addEventListener("pointercancel",this.onDocPointerDone,R),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,R),this.document.removeEventListener("pointerup",this.onDocPointerDone,R),this.document.removeEventListener("pointercancel",this.onDocPointerDone,R),this.docMoveBound=!1)}getCropStyle(){const{crop:e}=this.props;if(e)return{top:`${e.y}${e.unit}`,left:`${e.x}${e.unit}`,width:`${e.width}${e.unit}`,height:`${e.height}${e.unit}`}}dragCrop(){const{evData:e}=this,t=this.getBox(),o=this.makePixelCrop(t),i=e.clientX-e.startClientX,n=e.clientY-e.startClientY;return o.x=b(e.startCropX+i,0,t.width-o.width),o.y=b(e.startCropY+n,0,t.height-o.height),o}getPointRegion(e,t,o,i){const{evData:n}=this,a=n.clientX-e.x,l=n.clientY-e.y;let h;i&&t?h=t==="nw"||t==="n"||t==="ne":h=l<n.startCropY;let r;return o&&t?r=t==="nw"||t==="w"||t==="sw":r=a<n.startCropX,r?h?"nw":"sw":h?"ne":"se"}resolveMinDimensions(e,t,o=0,i=0){const n=Math.min(o,e.width),a=Math.min(i,e.height);return!t||!n&&!a?[n,a]:t>1?n?[n,n/t]:[a*t,a]:a?[a*t,a]:[n,n/t]}resizeCrop(){const{evData:e}=this,{aspect:t=0,maxWidth:o,maxHeight:i}=this.props,n=this.getBox(),[a,l]=this.resolveMinDimensions(n,t,this.props.minWidth,this.props.minHeight);let h=this.makePixelCrop(n);const r=this.getPointRegion(n,e.ord,a,l),c=e.ord||r;let w=e.clientX-e.startClientX,g=e.clientY-e.startClientY;(a&&c==="nw"||c==="w"||c==="sw")&&(w=Math.min(w,-a)),(l&&c==="nw"||c==="n"||c==="ne")&&(g=Math.min(g,-l));const d={unit:"px",x:0,y:0,width:0,height:0};r==="ne"?(d.x=e.startCropX,d.width=w,t?(d.height=d.width/t,d.y=e.startCropY-d.height):(d.height=Math.abs(g),d.y=e.startCropY-d.height)):r==="se"?(d.x=e.startCropX,d.y=e.startCropY,d.width=w,t?d.height=d.width/t:d.height=g):r==="sw"?(d.x=e.startCropX+w,d.y=e.startCropY,d.width=Math.abs(w),t?d.height=d.width/t:d.height=g):r==="nw"&&(d.x=e.startCropX+w,d.width=Math.abs(w),t?(d.height=d.width/t,d.y=e.startCropY-d.height):(d.height=Math.abs(g),d.y=e.startCropY+g));const m=k(d,t,r,n.width,n.height,a,l,o,i);return t||u.xyOrds.indexOf(c)>-1?h=m:u.xOrds.indexOf(c)>-1?(h.x=m.x,h.width=m.width):u.yOrds.indexOf(c)>-1&&(h.y=m.y,h.height=m.height),h.x=b(h.x,0,n.width-h.width),h.y=b(h.y,0,n.height-h.height),h}renderCropSelection(){const{ariaLabels:e=u.defaultProps.ariaLabels,disabled:t,locked:o,renderSelectionAddon:i,ruleOfThirds:n,crop:a}=this.props,l=this.getCropStyle();if(a)return p.createElement("div",{style:l,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":e.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!t&&!o&&p.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},p.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),p.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),p.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),p.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":e.nwDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"nw"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":e.nDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"n"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":e.neDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"ne"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":e.eDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"e"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":e.seDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"se"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":e.sDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"s"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":e.swDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"sw"),role:"button"}),p.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":e.wDragHandle,onKeyDown:h=>this.onHandlerKeyDown(h,"w"),role:"button"})),i&&p.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:h=>h.stopPropagation()},i(this.state)),n&&p.createElement(p.Fragment,null,p.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),p.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(e){const t={...M,...this.props.crop||{}};return x(t,e.width,e.height)}render(){const{aspect:e,children:t,circularCrop:o,className:i,crop:n,disabled:a,locked:l,style:h,ruleOfThirds:r}=this.props,{cropIsActive:c,newCropIsBeingDrawn:w}=this.state,g=n?this.renderCropSelection():null,d=H("ReactCrop",i,c&&"ReactCrop--active",a&&"ReactCrop--disabled",l&&"ReactCrop--locked",w&&"ReactCrop--new-crop",n&&e&&"ReactCrop--fixed-aspect",n&&o&&"ReactCrop--circular-crop",n&&r&&"ReactCrop--rule-of-thirds",!this.dragStarted&&n&&!n.width&&!n.height&&"ReactCrop--invisible-crop",o&&"ReactCrop--no-animate");return p.createElement("div",{ref:this.componentRef,className:d,style:h},p.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},t),n?p.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},p.createElement("defs",null,p.createElement("mask",{id:`hole-${this.instanceId}`},p.createElement("rect",{width:"100%",height:"100%",fill:"white"}),o?p.createElement("ellipse",{cx:`${n.x+n.width/2}${n.unit}`,cy:`${n.y+n.height/2}${n.unit}`,rx:`${n.width/2}${n.unit}`,ry:`${n.height/2}${n.unit}`,fill:"black"}):p.createElement("rect",{x:`${n.x}${n.unit}`,y:`${n.y}${n.unit}`,width:`${n.width}${n.unit}`,height:`${n.height}${n.unit}`,fill:"black"}))),p.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,g)}};D.xOrds=["e","w"],D.yOrds=["n","s"],D.xyOrds=["nw","ne","se","sw"],D.nudgeStep=1,D.nudgeStepMedium=10,D.nudgeStepLarge=100,D.defaultProps={ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}};let K=D;export{P as H,S as I,K as X,x as y};
