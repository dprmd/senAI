import{r,j as n}from"./pnpm-react@18.3.1--FUz9cRTN.js";import{u as F}from"./src-store-useSettingsStore.js--zqtBzO6.js";import{u as L}from"./pnpm-zustand@4.5.4_@types_react@18.3.3_react@18.3.1--EhdkWrrw.js";import{X as H,y as U,H as T,I as W}from"./pnpm-react-image-crop@11.0.6_react@18.3.1--DSzYCrTu.js";import{t as C}from"./src-components-ui-use-toast.js-w7cDmHIs.js";import{u as _}from"./src-hooks-useUpdateProfilePhoto.jsx-97B9xay-.js";import{u as M}from"./pnpm-react-i18next@15.0.1_i18next@23.12.2_react-dom@18.3.1_react@18.3.1__react@18.3.1--C-fP4VmU.js";import{a as A}from"./pnpm-react-router@6.26.0_react@18.3.1--BYg1aRBq.js";import{m as X}from"./pnpm-framer-motion@11.3.22_react-dom@18.3.1_react@18.3.1__react@18.3.1--COr7I5SZ.js";const y=1,x=150,D=(a,c,o,g)=>{const e=c.getContext("2d");e||C({description:g("no_2d_context"),duration:3e3,variant:"destructive"});const i=window.devicePixelRatio,f=a.naturalWidth/a.width,p=a.naturalHeight/a.height;c.width=Math.floor(o.width*f*i),c.height=Math.floor(o.height*p*i),e.scale(i,i),e.imageSmoothingQuality="high",e.save();const v=o.x*f,l=o.y*p;e.translate(-v,-l),e.drawImage(a,0,0,a.naturalWidth,a.naturalHeight,0,0,a.naturalWidth,a.naturalHeight),e.restore()},V=()=>{const[a,c,o,g]=F(L(t=>[t.imageFile,t.setImageFile,t.haveSelectImageFile,t.setHaveSelectImageFile])),{t:e}=M(),i=A(),f=_(),p=r.useRef(null),v=r.useRef(null),l=r.useRef(null),b=r.useRef(null),[I,S]=r.useState(),[R,j]=r.useState(""),[P,E]=r.useState(!1),N=t=>{const{width:s,height:h}=t.currentTarget,d=x/s*100,m=T({unit:"%",width:d},y,s,h),u=W(m,s,h);S(u)},k=()=>{c(""),g(!1),i("/settings")};return r.useEffect(()=>{o||i("/settings")},[]),r.useEffect(()=>{const t=new FileReader,s=(d,m)=>{const{naturalWidth:u,naturalHeight:w}=d.currentTarget;if(u<x||w<x)return C({description:e("image_too_small"),variant:"destructive",duration:3e3}),k(),j("");j(m)},h=()=>{var u;const d=((u=t.result)==null?void 0:u.toString())||"",m=new Image;m.src=d,m.addEventListener("load",w=>{s(w,d)})};return t.addEventListener("load",h),o&&t.readAsDataURL(a),()=>{t.removeEventListener("load",h),c(""),g(!1)}},[]),n.jsxs(X.div,{className:"min-w-screen no-scrollbar z-30 flex min-h-screen flex-col items-center justify-start bg-white dark:bg-black",initial:{opacity:0,transition:{duration:.2}},animate:{opacity:1,transition:{duration:.2}},exit:{opacity:0,transition:{duration:.2}},children:[n.jsx("div",{className:"m-4 flex max-h-[550px] max-w-[400px] items-center justify-center overflow-hidden",ref:v,children:n.jsx(H,{ref:p,onChange:(t,s)=>{S(s)},crop:I,circularCrop:!0,keepSelection:!0,aspect:y,minWidth:x,children:n.jsx("img",{ref:l,src:R,alt:"CroppedImage",className:"max-h-[450px] min-h-[150px] min-w-[150px] border border-slate-400 object-contain duration-100 dark:border dark:border-slate-600",onLoad:N})})}),n.jsxs("div",{className:"fixed bottom-0 left-0 right-0 flex h-[60px] items-center justify-center bg-white text-slate-900 dark:bg-black dark:text-slate-100",children:[n.jsx("button",{className:"mx-4 my-2 inline-block rounded-md px-4 py-2 active:bg-slate-200 dark:active:bg-slate-800",onClick:k,children:e("cancel")}),n.jsx("button",{className:"mx-4 my-2 inline-block rounded-md px-4 py-2 active:bg-slate-200 dark:active:bg-slate-800",onClick:()=>{P||(D(l.current,b.current,U(I,l.current.width,l.current.height),e),f(b.current)),E(!0)},children:e("done")})]}),I&&n.jsx("canvas",{ref:b,style:{display:"none",width:150,height:150,objectFit:"contain"},className:"mb-[140px]"})]})};export{V as I};
