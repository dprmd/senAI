import{r as n,j as r}from"./pnpm-react@18.3.1--FUz9cRTN.js";import{u as N}from"./src-store-useSettingsStore.js--zqtBzO6.js";import{u as F}from"./pnpm-zustand@4.5.4_@types_react@18.3.3_react@18.3.1--EhdkWrrw.js";import{X as P,y as L,H,I as T}from"./pnpm-react-image-crop@11.0.6_react@18.3.1--DSzYCrTu.js";import{t as C}from"./src-components-ui-use-toast.js-w7cDmHIs.js";import{u as W}from"./src-hooks-useUpdateProfilePhoto.jsx-7ifB8AQV.js";import{u as _}from"./pnpm-react-i18next@15.0.1_i18next@23.12.2_react-dom@18.3.1_react@18.3.1__react@18.3.1--C-fP4VmU.js";import{a as U}from"./pnpm-react-router@6.26.0_react@18.3.1--BYg1aRBq.js";import{m as M}from"./pnpm-framer-motion@11.3.22_react-dom@18.3.1_react@18.3.1__react@18.3.1--COr7I5SZ.js";const S=1,x=150,A=(a,c,i,g)=>{const e=c.getContext("2d");e||C({description:g("no_2d_context"),duration:3e3,variant:"destructive"});const o=window.devicePixelRatio,p=a.naturalWidth/a.width,f=a.naturalHeight/a.height;c.width=Math.floor(i.width*p*o),c.height=Math.floor(i.height*f*o),e.scale(o,o),e.imageSmoothingQuality="high",e.save();const v=i.x*p,l=i.y*f;e.translate(-v,-l),e.drawImage(a,0,0,a.naturalWidth,a.naturalHeight,0,0,a.naturalWidth,a.naturalHeight),e.restore()},J=()=>{const[a,c,i,g]=N(F(t=>[t.imageFile,t.setImageFile,t.haveSelectImageFile,t.setHaveSelectImageFile])),{t:e}=_(),o=U(),p=W(),f=n.useRef(null),v=n.useRef(null),l=n.useRef(null),b=n.useRef(null),[I,j]=n.useState(),[R,k]=n.useState(""),E=t=>{const{width:s,height:h}=t.currentTarget,d=x/s*100,m=H({unit:"%",width:d},S,s,h),u=T(m,s,h);j(u)},y=()=>{c(""),g(!1),o("/settings")};return n.useEffect(()=>{i||o("/settings")},[]),n.useEffect(()=>{const t=new FileReader,s=(d,m)=>{const{naturalWidth:u,naturalHeight:w}=d.currentTarget;if(u<x||w<x)return C({description:e("image_too_small"),variant:"destructive",duration:3e3}),y(),k("");k(m)},h=()=>{var u;const d=((u=t.result)==null?void 0:u.toString())||"",m=new Image;m.src=d,m.addEventListener("load",w=>{s(w,d)})};return t.addEventListener("load",h),i&&t.readAsDataURL(a),()=>{t.removeEventListener("load",h),c(""),g(!1)}},[]),r.jsxs(M.div,{className:"min-w-screen no-scrollbar z-30 flex min-h-screen flex-col items-center justify-center bg-white dark:bg-black",initial:{opacity:0,transition:{duration:.2}},animate:{opacity:1,transition:{duration:.2}},exit:{opacity:0,transition:{duration:.2}},children:[r.jsx("div",{className:"m-4 flex max-h-[550px] max-w-[400px] items-center justify-center overflow-hidden",ref:v,children:r.jsx(P,{ref:f,onChange:(t,s)=>{j(s)},crop:I,circularCrop:!0,keepSelection:!0,aspect:S,minWidth:x,children:r.jsx("img",{ref:l,src:R,alt:"CroppedImage",className:"max-h-[450px] min-h-[150px] min-w-[150px] border border-slate-400 object-contain duration-100 dark:border dark:border-slate-600",onLoad:E})})}),r.jsxs("div",{className:"fixed bottom-0 left-0 right-0 flex h-[60px] items-center justify-center bg-white text-slate-900 dark:bg-black dark:text-slate-100",children:[r.jsx("button",{className:"mx-4 my-2 inline-block rounded-md px-4 py-2 active:bg-slate-200 dark:active:bg-slate-800",onClick:y,children:e("cancel")}),r.jsx("button",{className:"mx-4 my-2 inline-block rounded-md px-4 py-2 active:bg-slate-200 dark:active:bg-slate-800",onClick:()=>{A(l.current,b.current,L(I,l.current.width,l.current.height),e),p(b.current)},children:e("done")})]}),I&&r.jsx("canvas",{ref:b,style:{display:"none",width:150,height:150,objectFit:"contain"},className:"mb-[140px]"})]})};export{J as I};
